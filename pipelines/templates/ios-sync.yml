steps:
  - checkout: self
    path: "./s/"
    fetchDepth: 0
  - checkout: iOS-certificates
  # Set up environment
  - template: ./install-ruby.yml
  - script: gem install bundler:2.4.12
    displayName: "Install bundler"

  # Install gems and run Fastlane
  - script: |
      bundle install
    displayName: "Install Ruby gems"
  - script: |
      bundle exec fastlane syncAll
    displayName: "Sync all iOS certificates"
    workingDirectory: "ios"
    env:
      MATCH_GIT_BEARER_AUTHORIZATION: $(System.AccessToken)
      MATCH_PASSWORD: $(MATCH_PASSWORD)
